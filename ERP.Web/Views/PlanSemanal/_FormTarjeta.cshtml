@model Mantenimiento.Datos.Entidades.PlanSemanaDetalle


@using (Html.BeginForm("GuardarTarjeta", "PlanSemanal", FormMethod.Post, new { id = "frmTarjeta", @class = "form", enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    @Html.HiddenFor(x => x.idPlanDetalle)
    @Html.HiddenFor(x => x.idPlanSemana)
    @Html.HiddenFor(x => x.idObservacion)

    <div class="row g-5 mb-5">
        <div class="col-md-6">
            <label class="form-label required">Requerimiento</label>
            <select id="ddlRequerimiento" class="form-select" data-control="select2" data-placeholder="Seleccione requerimiento">
                <option></option>
            </select>
            <div class="text-muted fs-7 mt-1">Selecciona el requerimiento padre.</div>
        </div>

        <div class="col-md-6">
            <label class="form-label required">SubRequerimiento</label>

            <!-- IMPORTANTE: name="idRequerimientoDetalle" para el model binder -->
            <select id="ddlSubRequerimiento" name="idRequerimientoDetalle" class="form-select" data-control="select2" data-placeholder="Seleccione subrequerimiento">
                <option></option>
            </select>

            <div class="text-muted fs-7 mt-1">Se filtrará según el requerimiento.</div>
        </div>
    </div>

    <div class="row g-5">
        <div class="col-md-3">
            <label class="form-label">Día</label>
            @Html.DropDownListFor(x => x.dia,
                new SelectList(new[] {
                    new { Value=0, Text="Lunes" },
                    new { Value=1, Text="Martes" },
                    new { Value=2, Text="Miércoles" },
                    new { Value=3, Text="Jueves" },
                    new { Value=4, Text="Viernes" },
                    new { Value=5, Text="Sábado" },
                    new { Value=6, Text="Domingo" }
                }, "Value", "Text", Model.dia),
                new { @class = "form-select", data_control = "select2" })
        </div>

        <div class="col-md-3">
            <label class="form-label">Prioridad</label>
            @Html.DropDownListFor(x => x.prioridad,
                new SelectList(new[] {
                    new { Value=1, Text="Alta" },
                    new { Value=2, Text="Media" },
                    new { Value=3, Text="Baja" }
                }, "Value", "Text", Model.prioridad),
                new { @class = "form-select", data_control = "select2" })
        </div>

        <div class="col-md-3">
            <label class="form-label">Estado</label>
            @Html.DropDownListFor(x => x.estado,
                new SelectList(new[] {
                    new { Value="pendiente", Text="Pendiente" },
                    new { Value="proceso", Text="En proceso" },
                    new { Value="hecho", Text="Hecho" },
                    new { Value="bloqueado", Text="Bloqueado" }
                }, "Value", "Text", (Model.estado ?? "pendiente")),
                new { @class = "form-select", data_control = "select2" })
        </div>

        <div class="col-md-3">
            <label class="form-label">Horas</label>
            @Html.TextBoxFor(x => x.horas, new { @class = "form-control", placeholder = "Ej: 4" })
        </div>
    </div>

    <div class="mt-5">
        <label class="form-label required">Título</label>
        @Html.TextBoxFor(x => x.titulo, new { @class = "form-control", placeholder = "Ej: Ajustar validación..." })
    </div>

    <div class="mb-5">
        <label class="form-label">Trabajador</label>
        <select id="ddlTrabajador" name="idPersonaResponsable" class="form-select" data-control="select2" data-placeholder="Seleccione trabajador">
            <option></option>
        </select>
    </div>
    <!--<div class="mb-5">
        <label class="form-label fw-bold">Adjunto (opcional)</label>

        <div id="drop-area-tarjeta"
             class="border border-dashed border-primary text-center p-3 mb-3"
             style="cursor:pointer">

            <i class="fas fa-cloud-upload-alt fa-2x text-primary mb-2"></i>
            <p class="mb-0">Arrastra o selecciona un archivo</p>-->

            <!-- INPUT REAL -->
            <!--<input type="file"
                   id="tarjeta_file"
                   name="archivo"-->   <!-- 👈 ESTE name ES CLAVE -->
            <!--class="d-none"
            accept="image/*,.pdf">
        </div>

        <div id="file-preview-tarjeta" style="display:none">
            <strong id="preview-name-tarjeta"></strong>
            <span id="preview-size-tarjeta" class="text-muted ms-2"></span>
            <button type="button"
                    id="remove-file-btn-tarjeta"
                    class="btn btn-sm btn-danger ms-2">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>-->
    <div class="mb-5">
        <div class="col-md-12">
            <label class="form-label fw-bold">Adjunto (opcional)</label>

            <!-- Área de arrastrar y soltar -->
            <div id="drop-area-task" class="drop-area border-2 border-dashed border-primary text-center p-3 mb-3" style="cursor: pointer;">
                <div class="drop-area-content">
                    <i class="fas fa-cloud-upload-alt fa-2x text-primary mb-2"></i>
                    <p class="mb-0">Arrastra y suelta un archivo aquí</p>
                    <input type="file" id="task_file" name="archivo" class="d-none">
                </div>
            </div>

            <!-- Vista previa del archivo -->
            <div id="file-preview-task" class="file-preview" style="display: none;">
                <div class="file-item">
                    <div class="file-info">
                        <div class="d-flex align-items-center">
                            <div class="file-icon">
                                <i class="fas fa-file"></i>
                            </div>
                            <div class="file-details">
                                <div class="file-name" id="preview-name-task">Nombre del archivo</div>
                                <div class="file-size" id="preview-size-task">Tamaño del archivo</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn btn-sm btn-remove" type="button" id="remove-file-btn-task" title="Eliminar archivo">
                                <i class="fas fa-trash" style="color: white"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mensaje cuando no hay archivo -->
            <div id="no-file-message-task" class="text-center text-muted py-3" style="display: none;">
                <i class="fas fa-inbox fa-2x mb-2"></i>
                <p class="mb-0">No hay archivo seleccionado</p>
            </div>

        </div>
    </div>


    <!-- Campos ocultos para almacenar información del archivo -->
    <input type="hidden" id="task_nombreArchivo" name="NombreArchivo" value="@Model.NombreArchivo"  />
    <input type="hidden" id="task_extension" name="Extension" value="@Model.Extension" />
    <input type="hidden" id="task_fileSize" />


    <!-- Valores para preselección -->
    <input type="hidden" id="hdSubSelected" value="@Model.idRequerimientoDetalle" />
    <input type="hidden" id="hdAsociado" name="idObservacion" value="@Model.idObservacion" />
}

<input type="hidden" id="hdTrabSelected" value="@(Model.idPersonaResponsable ?? 0)" />